# 应用程序初始化

**H2O的web应用程序必须开启urlrewrite,否则H2O的web应用无法正常运行，为了url的高颜值，也是为了提高系统的安全性！本章先以重写配置为例开始讲述应用程序的初始化部分。**

* **apache 重写\(urlrewrite\)**

H2O框架，必须需要开启url rewrite模式，以下是apache实例

```
例如：
file：/web/.htaccess
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]
```

* **nginx 重写\(urlrewrite\)**

H2O框架，必须需要开启url rewrite模式，以下是nginx实例
```
例如：
file：conf/vhost/test.conf
server {
      listen       80;
      server_name  crm.test.com;
      index index.html index.htm index.php;
      root 站点目录;
      location / {
              index index.php;
              if (!-e $request_filename){
                      rewrite ^/crm/(.*) /crm/index.php last;
                      rewrite ^/mms/(.*) /mms/index.php last;
              }
      }
      location ~ .*\.(php|php5)?$
      {
              #fastcgi_pass  unix:/tmp/php-cgi.sock;
              fastcgi_pass  127.0.0.1:9000;
              fastcgi_index index.php;
              include fastcgi.conf;
      }
      location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
      {
              expires 30d;
      }
      location ~ .*\.(js|css)?$
      {
              expires 1h;
      }
}
```

**web应用程序\(web application\)**

* Web应用程序初始化，Web入口程序编写实例
  ```
  例如：
  file：/web/index.php
  <?php
  $rootpath = dirname(dirname(__DIR__));
  require($rootpath . '/vendor/ybluesky/h2o/h2o.php');
  (new H2O\web\Application(include($rootpath.'/configs/crm.php')))->run();
  ?>
  ```


命令行应用程序\(**command line application\)**

* 应用程序初始化，Web入口程序编写实例

  ```
  例如(linux)：
  file：/command
  #!/usr/bin/env php
  <?php
  require(__DIR__ . '/vendor/ybluesky/h2o/h2o.php');
  (new H2O\console\Application(include(__DIR__.'/configs/cmd.php')))->run();
  ?>
  ```

  ```
  例如(windows)：
  file：/command
  #!/usr/bin/env php
  <?php
  require(__DIR__ . '/vendor/ybluesky/h2o/h2o.php');
  (new H2O\console\Application(include(__DIR__.'/configs/cmd.php')))->run();
  ?>
  file：/command.bat
  @echo off
  @setlocal
  set H2O_PATH=%~dp0
  if "%PHP_COMMAND%" == "" set PHP_COMMAND=php.exe
  "%PHP_COMMAND%" "%H2O_PATH%command" %*
  @endlocal
  ```


应用配置\(**configs code\)**

* 应用初始化时的配置参数

  ```
  file:/configs/crm.php
  <?php
  /**
  * 系统公共配置信息
  */
  return [
    'version'    =>   '0.0.9', //系统版本号
    'runner'     =>   'dev', //prod:生产环境，dev:开发环境，test:测试环境 默认情况下为prod
    'basePath'   =>   dirname(__DIR__).DS.'mdls'.DS.'crm', //程序主目录
    'defaultLayout' => 'layout.index',//默认布局
    'debug'      =>   true, //查看程序执行情况 例如运行时间、消耗内存等
    'db'         =>   [
            'db'   =>  [ //默认库
                 'host'            =>    'localhost',
                 'username'    =>    'root',
                 'password'    =>    '123',
                 'dbname'    =>    'detest'
            ],
            'log'  =>  [ //Log数据库 也是默认库
                 'host'        =>    'localhost',
                 'username'    =>    'root',
                 'password'    =>    '123',
                 'dbname'    =>    'log'
            ]
    ] //数据库配置信息
  ];
  ```


* 参数相关的配置详见“配置参数”章节



