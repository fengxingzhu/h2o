# 数据库操作常用函数

**H2O SQL command functions** -- 基于PDO的SQL命令行常用函数

* **setSql**

设置SQL语句

```
$this->setSql('SELECT * FROM test');
```

* **getSql**

获取当前操作SQL语句

```
$sql = $this->getSql();
echo $sql;
```

* **getRawSql**

获取当前操作解析后SQL语句，主要用于调试程序等

```
$sql = $this->insert('sys_menu',['sm_id'=>1,'sm_title=>'test','sm_pid'=>0])->getRawSql();
echo $sql;
```

* **execute**

执行一条预处理语句,成功返回true,否则返回false

* * 例如：


```
$this->setSql('DELETE FROM test WHERE id=?')->bindValues([$id])->execute();
```

* **insert**

写入数据到数据库,插入成功返回true,否则返回false

* * 例1：单条插入


```
$this->insert('sys_menu',['sm_id'=>1,'sm_title=>'test','sm_pid'=>0])->execute();
```

* * 例2：多条信息插入


```
$this->insert('sys_menu',
[
   [1,'first menu',0],
   [2,'second menu',1]
],
['sm_id','sm_title,'sm_pid']
)->execute();
```

* **batchInsert**

当大数据时，使用insert方法，无法分批处理，batchInsert解决insert的批处理问题

```
$this->batchInsert('sys_menu',
[
   ['sm_id'=>1,'sm_title'=>'first menu','sm_pid'=>0],
   ['sm_id'=>2,'sm_title'=>'second menu','sm_pid'=>0],
   ...
],
['sm_id','sm_title,'sm_pid'], 
1000 //单批处理数量
)->execute();
```

* **update**

更改数据到数据库,插入成功返回true,否则返回false

```
$this->update('sys_menu',['sm_id'=>1,'sm_title=>'test','sm_pid'=>0],'id=1')->execute();
```

* **bindValue**

单个占位符的绑定

```
$this->update('sys_menu',['sm_id'=>1,'sm_title=>'test','sm_pid'=>0],'id=:id')->bindValue(':id',1)->execute();
```

* **bindValues**

批量占位符的绑定

```
$this->update('sys_menu',['sm_id'=>1,'sm_title=>'test','sm_pid'=>0],'type=? AND isdel=?')->bindValues([1,2])->execute();
```

* **fetch**

获取单行数据

```
return $this->setSql('SELECT * FROM test WHERE id=1')->fetch();
```

* **fetchAll**

获取多行数据

```
return $this->setSql('SELECT * FROM test')->fetchAll();
```

* **rowCount**

返回结果集行数

```
return $this->setSql('SELECT * FROM test')->rowCount();
```

* **pageData**

获取翻页信息和当前页数据

```
$result = $this->setSql('SELECT * FROM test')->pageData(10,'p'); //翻页数据
/**
 * 返回数组结果为：
[
  'page'   =>  [ //翻页信息
        'param'    => $param,        //翻页参数
        'size'     => $size,         //每页条数，步长
        'page'     => $cpage,        //当前页
        'last'     => $ptotal,       //总页数，即最后一页
        'next'     => $next,         //下一页
        'prev'     => $up,           //上一页
        'total' => $total         //总记录数
  ],
  'data'   => [] //当前页数据
]
*/
```

* **batch**

迭代批处理对象

```
$db = new \H2O\db\Command();
$query = $db->setSql('SELECT * FROM user ORDER BY us_id DESC')->batch(10);//每批次处理10行数据
foreach ($query as $k=>$v){
  echo $v['us_id'].'<br>';
}
```

* **getColumnName**

返回对应表的列名信息

```
$cols = $this->getColumnName('test');
print_r($cols);
```

* **lastInsertId**

返回插入的最后ID

```
$lastid = $this->lastInsertId();
echo $lastid;
```

* **getTables**

获取表信息

```
$alltables = $this->getTables();//全部表
$pretables = $this->getTables('log_data_');//以log_data_为前缀的表
```



