# 图型验证码使用方法

**H2O captcha** -- 基于captcha包的常用验证方法

* **使用方法**

控制器调用方法，例如：根目录/apps/crm/controllers/site.php

```
<?php
namespace app\crm\controllers;
use H2O\web\Controller;
class Site extends Controller
{
  /**
   * 构造函数
   */
  public function __construct()
  {
      parent::__construct();
      $this->clearLayout(); // 清空布局
  }
  /**
   * 默认首页,特别说明暴露给url的方法，必须写前缀act
   */
  public function actIndex()
  {
      return $this->render('index');
  }
  /**
   * 显示验证码
   * @return string
   */
  public function actVercode()
  {
      $captcha = new \H2O\captcha\Captcha();
      $captcha->setValue(mt_rand(1000,9999));
      $captcha->build(120, 40);
      $val = $captcha->getValue();
      setcookie('vercode',strtolower($val));
      $captcha->getImage();
  }
}
?>
```

板模调用图型验证码，连接地址为:site.vercode

```
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<script src="assets/js/jquery-2.2.1.min.js"></script>
<body>
<div>
  <form method="post" role="form" class="ajaxform" action="site.login">
        <div class="form-group">
            <div class="input-group">
                <span class="input-group-addon"><i class="fa fa-user"></i></span>
                <input type="text" class="form-control input-md" name="username" placeholder="用户名" dataType="Require" msg="用户名必须填写" />
            </div>
        </div>
        <div class="form-group">
            <div class="input-group">
                <span class="input-group-addon"><i class="fa fa-lock"></i></span>
                <input type="password" class="form-control input-md" name="password" placeholder="密码" dataType="Require" msg="密码必须填写" />
            </div>
        </div>
        <div class="form-group">
            <input type="text" class="form-control input-md" name="vercode" placeholder="验证码"  dataType="Require" msg="请输入验证码"/>
            <img src="site.vercode" class="vercodeimg" onclick="vercodechange(this)" alt="看不清？点击更换">
        </div> 
        <button type="submit" name="submitButton" class="btn btn-lg btn-primary btn-block">登　　录</button>
    </form>
</div>
<script type="text/javascript">
    function vercodechange(t)
    {
        t.src = 'site.vercode?'+parseInt(Math.random(4) * 1000);
        $('input[name="vercode"]').val('');//清空输入的验证码
    }
</script>
</body>
</html>
```



